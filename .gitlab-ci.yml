cache:
    paths:
        - vendor/

stages:
    - setup
    - test
    - deploy

setup:
    stage: setup
    script:
        - composer update --no-progress
        - bin/console --env=test doctrine:database:create
        - bin/console --env=test doctrine:schema:create

test:
    stage: test
    script:
        - vendor/bin/phpunit -c ./
        - vendor/bin/phpcpd src/
        - vendor/bin/phpcs -n --extensions=php --standard=PSR2 src/

deploy:
    stage: deploy
    only:
        - master
    artifacts:
        path: ./
        expire_in: 1 week
        keep_latest: 1
    script:
        - ( find . -type d -name ) | xargs rm -rf
