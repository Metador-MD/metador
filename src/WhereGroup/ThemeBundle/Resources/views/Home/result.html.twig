{% if rows is defined and rows is iterable %}
{% for row in rows if is_granted('view', row.object|json_decode(true)) %}

    {% set p = row.object|json_decode(true) %}
    {% set editable = app.user and is_granted('edit', p) %}
    {% set title = p.title is defined ? p.title|teaser(75, true) : 'noname' %}

    <div class="search-result">
        <div class="result-header">
            <div class="left">
                <img src="{{ p['browserGraphic'] }}" class="md-result-preview-img"/>
            </div>
            <div class="right">
                <div class="md-result-title">
                    {% if app.user %}
                        <a href="{{ path('metadata_edit', { 'source': p['_source'],'profile' : p['_profile'], 'id' : p['_id'] }) }}">
                            {{ title }}
                        </a>
                    {% else %}
                        <a href="{{ path('metador_export_html', { 'id' : p['_id'] }) }}">
                            {{ title }}
                        </a>
                    {% endif %}

                    <div class="md-result-info">
                        {% if not editable and not app.user %}
                        <div class="result-icon" title="{% trans %}Um editieren zu können, müssen Sie angemeldet sein.{% endtrans %}">
                            <span class="icon-eye"></span>
                        </div>
                        {% elseif not editable and p['_locked'] is defined and p['_locked'] %}
                        <div class="result-icon" title="{% trans %}Datensatz ist derzeig gesperrt.{% endtrans %}">
                            <span class="icon-lock"></span>
                        </div>
                        {% elseif editable %}
                        <div class="result-icon">
                            <span class="icon-pencil"></span>
                        </div>
                        {% endif %}

                        <div class="result-icon">
                            <span class="icon-user"></span>
                        </div>
                    </div>
                </div>

                <div class="md-result-alternate-title">
                    {{ p['alternateTitle'] }}
                </div>

                <hr class="line-separator">

                <div class="md-result-abstract">
                    {{ p['abstract'] }}
                </div>
            </div>
        </div>
        <div class="result-footer">
            <div class="left">...</div>
            <div class="right">
                {% if app.environment == 'dev' %}
                    <a href="{{ path('metador_export_obj', { 'id' : p['_id'] }) }}" class="link">object</a>
                    <a href="{{ path('metador_export_json', { 'id' : p['_id'] }) }}" class="link">json</a>
                {% endif %}

                <a href="{{ path('metador_export_html', { 'id' : p['_id'] }) }}" class="link">html</a>
                <a href="{{ path('metador_export_xml', { 'id' : p['_id'] }) }}" class="link">xml</a>
            </div>
        </div>
    </div>
{% endfor %}
{% endif %}
