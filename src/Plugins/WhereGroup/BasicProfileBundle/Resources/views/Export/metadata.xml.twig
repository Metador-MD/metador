<gmd:MD_Metadata
    xmlns:srv="http://www.isotc211.org/2005/srv"
    xmlns:gmd="http://www.isotc211.org/2005/gmd"
    xmlns:gco="http://www.isotc211.org/2005/gco"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xmlns:gml="http://www.opengis.net/gml"
    xmlns:xlink="http://www.w3.org/1999/xlink"
    xsi:schemaLocation="http://www.isotc211.org/2005/gmd http://schemas.opengis.net/csw/2.0.2/profiles/apiso/1.0.0/apiso.xsd">

    {% if not array_is_empty(p,'fileIdentifier') %}
        <gmd:fileIdentifier>
            <gco:CharacterString>{{ p['fileIdentifier']|e }}</gco:CharacterString>
        </gmd:fileIdentifier>
    {% endif %}

    {% if not array_is_empty(p,'language') %}
        <gmd:language>
            <gmd:LanguageCode codeList="http://standards.iso.org/ittf/PubliclyAvailableStandards/ISO_19139_Schemas/resources/codelist/ML_gmxCodelists.xml#LanguageCode" codeListValue="{{ p['language']|e }}">{{ p['language']|e }}</gmd:LanguageCode>
        </gmd:language>
    {% endif %}

    {% if not array_is_empty(p,'characterSet') %}
        <gmd:characterSet>
            <gmd:MD_CharacterSetCode codeList="http://standards.iso.org/ittf/PubliclyAvailableStandards/ISO_19139_Schemas/resources/codelist/ML_gmxCodelists.xml#MD_CharacterSetCode" codeListValue="{{ p['characterSet']|e }}">{{ p['characterSet']|e }}</gmd:MD_CharacterSetCode>
        </gmd:characterSet>
    {% endif %}

    {% if not array_is_empty(p,'hierarchyLevel') %}
        <gmd:hierarchyLevel>
            <gmd:MD_ScopeCode codeList="http://standards.iso.org/ittf/PubliclyAvailableStandards/ISO_19139_Schemas/resources/codelist/ML_gmxCodelists.xml#MD_ScopeCode" codeListValue="{{ p['hierarchyLevel']|e }}">{{ p['hierarchyLevel']|e }}</gmd:MD_ScopeCode>
        </gmd:hierarchyLevel>
    {% endif %}

    {% if not array_is_empty(p,'hierarchyLevelName') %}
        <gmd:hierarchyLevelName>
            <gco:CharacterString>{{ p['hierarchyLevelName']|e }}</gco:CharacterString>
        </gmd:hierarchyLevelName>
    {% endif %}

    {% if not array_is_empty(p, 'contact') %}
    {% for contact in array_get(p, 'contact') %}
        {% if array_all_exists(contact, ['uuid','organisationName','positionName','email','role','country','url']) %}
        <gmd:contact>
            <gmd:CI_ResponsibleParty uuid="{{ contact['uuid']|e }}">
                {% if not array_is_empty(contact, 'individualName') %}
                <gmd:individualName>
                    <gco:CharacterString>{{ contact['individualName']|e }}</gco:CharacterString>
                </gmd:individualName>
                {% endif %}
                {% if not array_is_empty(contact, 'organisationName') %}
                <gmd:organisationName>
                    <gco:CharacterString>{{ contact['organisationName']|e }}</gco:CharacterString>
                </gmd:organisationName>
                {% endif %}
                {% if not array_is_empty(contact, 'positionName') %}
                <gmd:positionName>
                    <gco:CharacterString>{{ contact['positionName']|e }}</gco:CharacterString>
                </gmd:positionName>
                {% endif %}
                <gmd:contactInfo>
                    <gmd:CI_Contact>
                        <gmd:phone>
                            <gmd:CI_Telephone>
                                {% if not array_is_empty(contact, 'voice') %}
                                <gmd:voice>
                                    <gco:CharacterString>{{ contact['voice']|e }}</gco:CharacterString>
                                </gmd:voice>
                                {% endif %}
                                {% if not array_is_empty(contact, 'facsimile') %}
                                <gmd:facsimile>
                                    <gco:CharacterString>{{ contact['facsimile']|e }}</gco:CharacterString>
                                </gmd:facsimile>
                                {% endif %}
                            </gmd:CI_Telephone>
                        </gmd:phone>
                        <gmd:address>
                            <gmd:CI_Address>
                                {% if not array_is_empty(contact, 'deliveryPoint') %}
                                <gmd:deliveryPoint>
                                    <gco:CharacterString>{{ contact['deliveryPoint']|e }}</gco:CharacterString>
                                </gmd:deliveryPoint>
                                {% endif %}
                                {% if not array_is_empty(contact, 'city') %}
                                <gmd:city>
                                    <gco:CharacterString>{{ contact['city']|e }}</gco:CharacterString>
                                </gmd:city>
                                {% endif %}
                                {% if not array_is_empty(contact, 'administrativeArea') %}
                                <gmd:administrativeArea>
                                    <gco:CharacterString>{{ contact['administrativeArea']|e }}</gco:CharacterString>
                                </gmd:administrativeArea>
                                {% endif %}
                                {% if not array_is_empty(contact, 'postalCode') %}
                                <gmd:postalCode>
                                    <gco:CharacterString>{{ contact['postalCode']|e }}</gco:CharacterString>
                                </gmd:postalCode>
                                {% endif %}
                                {% if not array_is_empty(contact, 'country') %}
                                <gmd:country>
                                    <gco:CharacterString>{{ contact['country']|e }}</gco:CharacterString>
                                </gmd:country>
                                {% endif %}
                                {% if not array_is_empty(contact, 'email') %}
                                    {% for email in array_get(contact, 'email', {}) %}
                                        {% if email is defined and email is not empty %}
                                            <gmd:electronicMailAddress>
                                                <gco:CharacterString>{{ email|e }}</gco:CharacterString>
                                            </gmd:electronicMailAddress>
                                        {% endif %}
                                    {% endfor %}
                                {% endif %}
                            </gmd:CI_Address>
                        </gmd:address>
                        <gmd:onlineResource>
                            <gmd:CI_OnlineResource>
                                {% if not array_is_empty(contact, 'url') %}
                                <gmd:linkage>
                                    <gmd:URL>{{ contact['url']|e }}</gmd:URL>
                                </gmd:linkage>
                                {% endif %}
                                {% if not array_is_empty(contact, 'urlDescription') %}
                                <gmd:description>
                                    <gco:CharacterString>{{ contact['urlDescription']|e }}</gco:CharacterString>
                                </gmd:description>
                                {% endif %}
                            </gmd:CI_OnlineResource>
                        </gmd:onlineResource>
                    </gmd:CI_Contact>
                </gmd:contactInfo>
                {% if not array_is_empty(contact, 'role') %}
                    <gmd:role>
                        <gmd:CI_RoleCode codeList="http://standards.iso.org/ittf/PubliclyAvailableStandards/ISO_19139_Schemas/resources/codelist/ML_gmxCodelists.xml#CI_RoleCode" codeListValue="{{ array_get(contact, 'role') }}">{{ array_get(contact, 'role') }}</gmd:CI_RoleCode>
                    </gmd:role>
                {% endif %}
            </gmd:CI_ResponsibleParty>
        </gmd:contact>
        {% endif %}
    {% endfor %}
    {% endif %}
    {% if p['dateStamp'] is defined and p['dateStamp'] is not empty %}
    <gmd:dateStamp>
        <gco:Date>{{ p['dateStamp']|e }}</gco:Date>
    </gmd:dateStamp>
    {% endif %}
    {% if p['_standardName'] is defined and p['_standardName'] is not empty %}
    <gmd:metadataStandardName>
        <gco:CharacterString>{{ p['_standardName']|e }}</gco:CharacterString>
    </gmd:metadataStandardName>
    {% endif %}
    {% if p['_standardVersion'] is defined and p['_standardVersion'] is not empty %}
    <gmd:metadataStandardVersion>
        <gco:CharacterString>{{ p['_standardVersion']|e }}</gco:CharacterString>
    </gmd:metadataStandardVersion>
    {% endif %}
    {% if not array_is_empty(p, 'referenceSystemInfo') %}
    {% for referenceSystemInfo in array_get(p, 'referenceSystemInfo', {}) %}
    {% if referenceSystemInfo.title is defined and referenceSystemInfo.title is not empty %}
    <gmd:referenceSystemInfo>
        <gmd:MD_ReferenceSystem>
            <gmd:referenceSystemIdentifier>
                <gmd:RS_Identifier>
                    <gmd:authority>
                        <gmd:CI_Citation>
                            <gmd:title>
                                <gco:CharacterString>{{ referenceSystemInfo['title']|e }}</gco:CharacterString>
                            </gmd:title>
                            <gmd:date>
                                <gmd:CI_Date>
                                    <gmd:date>
                                        <gco:Date>{{ referenceSystemInfo['date']|e }}</gco:Date>
                                    </gmd:date>
                                    <gmd:dateType>
                                        <gmd:CI_DateTypeCode codeList="http://www.isotc211.org/2005/resources/codelist/gmxCodelists.xml#CI_DateTypeCode" codeListValue="{{ referenceSystemInfo['dateType']|e }}">{{ referenceSystemInfo['dateType']|e }}</gmd:CI_DateTypeCode>
                                    </gmd:dateType>
                                </gmd:CI_Date>
                            </gmd:date>
                        </gmd:CI_Citation>
                    </gmd:authority>
                    <gmd:code>
                        <gco:CharacterString>{{ referenceSystemInfo['code']|e }}</gco:CharacterString>
                    </gmd:code>
                    {% if referenceSystemInfo['codeSpace'] is defined %}
                    <gmd:codeSpace>
                        <gco:CharacterString>{{ referenceSystemInfo['codeSpace']|e }}</gco:CharacterString>
                    </gmd:codeSpace>
                    {% endif %}
                    {% if referenceSystemInfo['version'] is defined %}
                    <gmd:version>
                        <gco:CharacterString>{{ referenceSystemInfo['version']|e }}</gco:CharacterString>
                    </gmd:version>
                    {% endif %}
                </gmd:RS_Identifier>
            </gmd:referenceSystemIdentifier>
        </gmd:MD_ReferenceSystem>
    </gmd:referenceSystemInfo>
    {% endif %}
    {% endfor %}
    {% endif %}

    <gmd:identificationInfo>
        {#<gmd:MD_DataIdentification {% if p['identifierString'] is defined and p['hierarchyLevel'] == 'dataset' %}id="{{ p['identifierString'] }}"{% endif %}>#}
        <gmd:MD_DataIdentification>
            <gmd:citation>
                <gmd:CI_Citation>
                    {% if not array_is_empty(p, 'title') %}
                    <gmd:title>
                        <gco:CharacterString>{{ p['title']}}</gco:CharacterString>
                    </gmd:title>
                    {% endif %}
                    {% if not array_is_empty(p, 'alternateTitle') %}
                        {% for alternateTitle in array_get(p, 'alternateTitle', {}) %}
                            {% if alternateTitle is defined and alternateTitle is not empty %}
                            <gmd:alternateTitle>
                                <gco:CharacterString>{{ alternateTitle|e }}</gco:CharacterString>
                            </gmd:alternateTitle>
                            {% endif %}
                        {% endfor %}
                    {% endif %}
                    {% if not array_is_empty(p, 'creationDate') %}
                        <gmd:date>
                            <gmd:CI_Date>
                                <gmd:date>
                                    <gco:Date>{{ p['creationDate']|e }}</gco:Date>
                                </gmd:date>
                                <gmd:dateType>
                                    <gmd:CI_DateTypeCode codeList="http://www.isotc211.org/2005/resources/codelist/gmxCodelists.xml#CI_DateTypeCode" codeListValue="creation">creation</gmd:CI_DateTypeCode>
                                </gmd:dateType>
                            </gmd:CI_Date>
                        </gmd:date>
                    {% endif %}
                    {% if not array_is_empty(p, 'publicationDate') %}
                        <gmd:date>
                            <gmd:CI_Date>
                                <gmd:date>
                                    <gco:Date>{{ p['publicationDate']|e }}</gco:Date>
                                </gmd:date>
                                <gmd:dateType>
                                    <gmd:CI_DateTypeCode codeList="http://www.isotc211.org/2005/resources/codelist/gmxCodelists.xml#CI_DateTypeCode" codeListValue="publication">publication</gmd:CI_DateTypeCode>
                                </gmd:dateType>
                            </gmd:CI_Date>
                        </gmd:date>
                    {% endif %}
                    {% if not array_is_empty(p, 'revisionDate') %}
                        <gmd:date>
                            <gmd:CI_Date>
                                <gmd:date>
                                    <gco:Date>{{ p['revisionDate']|e }}</gco:Date>
                                </gmd:date>
                                <gmd:dateType>
                                    <gmd:CI_DateTypeCode codeList="http://www.isotc211.org/2005/resources/codelist/gmxCodelists.xml#CI_DateTypeCode" codeListValue="revision">revision</gmd:CI_DateTypeCode>
                                </gmd:dateType>
                            </gmd:CI_Date>
                        </gmd:date>
                    {% endif %}
                    {% if not array_is_empty(p, 'presentationForm') %}
                    <gmd:presentationForm>
                        <gmd:CI_PresentationFormCode codeListValue="{{ p['presentationForm']|e }}" codeList="http://www.isotc211.org/2005/resources/codeList.xml#CI_PresentationFormCode">{{ p['presentationForm']|e }}</gmd:CI_PresentationFormCode>
                    </gmd:presentationForm>
                    {% endif %}
                </gmd:CI_Citation>
            </gmd:citation>
            {% if not array_is_empty(p, 'abstract') %}
            <gmd:abstract>
                <gco:CharacterString>{{ p['abstract']|e }}</gco:CharacterString>
            </gmd:abstract>
            {% endif %}
            {% if not array_is_empty(p, 'responsibleParty') %}
            {% for contact in array_get(p, 'responsibleParty', {}) %}
            {% if array_all_exists(contact, ['uuid','organisationName','positionName','email','role','country','url']) %}
            <gmd:pointOfContact>
                <gmd:CI_ResponsibleParty uuid="{{ contact['uuid']|e }}">
                    {% if not array_is_empty(contact, 'individualName') %}
                        <gmd:individualName>
                            <gco:CharacterString>{{ contact['individualName']|e }}</gco:CharacterString>
                        </gmd:individualName>
                    {% endif %}
                    {% if not array_is_empty(contact, 'organisationName') %}
                        <gmd:organisationName>
                            <gco:CharacterString>{{ contact['organisationName']|e }}</gco:CharacterString>
                        </gmd:organisationName>
                    {% endif %}
                    {% if not array_is_empty(contact, 'positionName') %}
                        <gmd:positionName>
                            <gco:CharacterString>{{ contact['positionName']|e }}</gco:CharacterString>
                        </gmd:positionName>
                    {% endif %}
                    <gmd:contactInfo>
                        <gmd:CI_Contact>
                            <gmd:phone>
                                <gmd:CI_Telephone>
                                    {% if not array_is_empty(contact, 'voice') %}
                                        <gmd:voice>
                                            <gco:CharacterString>{{ contact['voice']|e }}</gco:CharacterString>
                                        </gmd:voice>
                                    {% endif %}
                                    {% if not array_is_empty(contact, 'facsimile') %}
                                        <gmd:facsimile>
                                            <gco:CharacterString>{{ contact['facsimile']|e }}</gco:CharacterString>
                                        </gmd:facsimile>
                                    {% endif %}
                                </gmd:CI_Telephone>
                            </gmd:phone>
                            <gmd:address>
                                <gmd:CI_Address>
                                    {% if not array_is_empty(contact, 'deliveryPoint') %}
                                        <gmd:deliveryPoint>
                                            <gco:CharacterString>{{ contact['deliveryPoint']|e }}</gco:CharacterString>
                                        </gmd:deliveryPoint>
                                    {% endif %}
                                    {% if not array_is_empty(contact, 'city') %}
                                        <gmd:city>
                                            <gco:CharacterString>{{ contact['city']|e }}</gco:CharacterString>
                                        </gmd:city>
                                    {% endif %}
                                    {% if not array_is_empty(contact, 'administrativeArea') %}
                                        <gmd:administrativeArea>
                                            <gco:CharacterString>{{ contact['administrativeArea']|e }}</gco:CharacterString>
                                        </gmd:administrativeArea>
                                    {% endif %}
                                    {% if not array_is_empty(contact, 'postalCode') %}
                                        <gmd:postalCode>
                                            <gco:CharacterString>{{ contact['postalCode']|e }}</gco:CharacterString>
                                        </gmd:postalCode>
                                    {% endif %}
                                    {% if not array_is_empty(contact, 'country') %}
                                        <gmd:country>
                                            <gco:CharacterString>{{ contact['country']|e }}</gco:CharacterString>
                                        </gmd:country>
                                    {% endif %}
                                    {% if not array_is_empty(contact, 'email') %}
                                        {% for email in array_get(contact, 'email', {}) %}
                                            {% if email is defined and email is not empty %}
                                                <gmd:electronicMailAddress>
                                                    <gco:CharacterString>{{ email|e }}</gco:CharacterString>
                                                </gmd:electronicMailAddress>
                                            {% endif %}
                                        {% endfor %}
                                    {% endif %}
                                </gmd:CI_Address>
                            </gmd:address>
                            <gmd:onlineResource>
                                <gmd:CI_OnlineResource>
                                    {% if not array_is_empty(contact, 'url') %}
                                        <gmd:linkage>
                                            <gmd:URL>{{ contact['url']|e }}</gmd:URL>
                                        </gmd:linkage>
                                    {% endif %}
                                    {% if not array_is_empty(contact, 'urlDescription') %}
                                        <gmd:description>
                                            <gco:CharacterString>{{ contact['urlDescription']|e }}</gco:CharacterString>
                                        </gmd:description>
                                    {% endif %}
                                </gmd:CI_OnlineResource>
                            </gmd:onlineResource>
                        </gmd:CI_Contact>
                    </gmd:contactInfo>
                    {% if not array_is_empty(contact, 'role') %}
                        <gmd:role>
                            <gmd:CI_RoleCode codeList="http://standards.iso.org/ittf/PubliclyAvailableStandards/ISO_19139_Schemas/resources/codelist/ML_gmxCodelists.xml#CI_RoleCode" codeListValue="{{ array_get(contact, 'role') }}">{{ array_get(contact, 'role') }}</gmd:CI_RoleCode>
                        </gmd:role>
                    {% endif %}
                </gmd:CI_ResponsibleParty>
            </gmd:pointOfContact>
            {% endif %}
            {% endfor %}
            {% endif %}
            {% if not array_is_empty(p, 'graphicOverview') %}
                {% for graphicOverview in array_get(p, 'graphicOverview') %}
                    {% if graphicOverview['fileName'] is defined and graphicOverview['fileName'] is not empty %}
                    <gmd:graphicOverview>
                        <gmd:MD_BrowseGraphic>
                            {% if array_get(graphicOverview, 'fileName') %}
                            <gmd:fileName>
                                <gco:CharacterString>{{ graphicOverview['fileName']|e }}</gco:CharacterString>
                            </gmd:fileName>
                            {% endif %}
                            {% if array_get(graphicOverview, 'fileDescription') %}
                            <gmd:fileDescription>
                                <gco:CharacterString>{{ graphicOverview['fileDescription']|e }}</gco:CharacterString>
                            </gmd:fileDescription>
                            {% endif %}
                        </gmd:MD_BrowseGraphic>
                    </gmd:graphicOverview>
                    {% endif %}
                {% endfor %}
            {% endif %}

            {% if not array_is_empty(p, 'keywords') %}
                {% for key, keyword in array_get(p, 'keywords') %}
                    <gmd:descriptiveKeywords>
                        <gmd:MD_Keywords id="{{ key|e }}">
                            {% if keyword['keywords'] is defined and keyword['keywords'] is iterable %}
                                {% for k in keyword['keywords'] %}
                                    {% if k is defined and k is not empty %}
                                    <gmd:keyword>
                                        <gco:CharacterString>{{ k|e }}</gco:CharacterString>
                                    </gmd:keyword>
                                    {% endif %}
                                {% endfor %}
                            {% endif %}
                            {% if keyword['name'] is defined and keyword['name'] is not empty and keyword['date'] is defined and keyword['date'] is not empty %}
                                <gmd:thesaurusName>
                                    <gmd:CI_Citation>
                                        <gmd:title>
                                            <gco:CharacterString>{{ keyword['name']|e }}</gco:CharacterString>
                                        </gmd:title>
                                        <gmd:date>
                                            <gmd:CI_Date>
                                                <gmd:date>
                                                    <gco:Date>{{ keyword['date']|e }}</gco:Date>
                                                </gmd:date>
                                                <gmd:dateType>
                                                    <gmd:CI_DateTypeCode codeList="http://standards.iso.org/ittf/PubliclyAvailableStandards/ISO_19139_Schemas/resources/codelist/ML_gmxCodelists.xml#CI_DateTypeCode" codeListValue="{{ keyword['type']|e }}">{{ keyword['type']|e }}</gmd:CI_DateTypeCode>
                                                </gmd:dateType>
                                            </gmd:CI_Date>
                                        </gmd:date>
                                    </gmd:CI_Citation>
                                </gmd:thesaurusName>
                            {% endif %}
                        </gmd:MD_Keywords>
                    </gmd:descriptiveKeywords>
                {% endfor %}
            {% endif %}

            {% if not array_is_empty(p, 'useLimitation') %}
                {% for useLimitation in array_get(p, 'useLimitation') %}
                    <gmd:resourceConstraints>
                        <gmd:MD_LegalConstraints>
                            <gmd:useLimitation>
                                {% if useLimitation is defined and useLimitation is not empty %}
                                    {% for useLimitation in useLimitation %}
                                        <gco:CharacterString>{{ useLimitation }}</gco:CharacterString>
                                    {% endfor %}
                                {% endif %}
                            </gmd:useLimitation>
                        </gmd:MD_LegalConstraints>
                    </gmd:resourceConstraints>
                {% endfor %}
            {% endif %}

            {% if not array_is_empty(p,'useConstraints') %}
            {% for constraint in array_get(p, 'useConstraints') %}
                {% if constraint.otherConstraints is defined and constraint.otherConstraints is not empty %}
                <gmd:resourceConstraints>
                    <gmd:MD_LegalConstraints>
                        {% if constraint.RestrictionCode is defined and constraint.RestrictionCode is not empty %}
                            <gmd:useConstraints>
                                <gmd:MD_RestrictionCode codeList="http://standards.iso.org/ittf/PubliclyAvailableStandards/ISO_19139_Schemas/resources/codelist/ML_gmxCodelists.xml#MD_RetrictionCode" codeListValue="{{ constraint.RestrictionCode }}">{{ constraint.RestrictionCode }}</gmd:MD_RestrictionCode>
                            </gmd:useConstraints>
                        {% endif %}
                        <gmd:useConstraints>
                            <gmd:MD_RestrictionCode codeList="http://standards.iso.org/ittf/PubliclyAvailableStandards/ISO_19139_Schemas/resources/codelist/ML_gmxCodelists.xml#MD_RetrictionCode" codeListValue="otherRestrictions">otherRestrictions</gmd:MD_RestrictionCode>
                        </gmd:useConstraints>
                        <gmd:otherConstraints>
                            <gco:CharacterString>{{ constraint.otherConstraints|e }}</gco:CharacterString>
                        </gmd:otherConstraints>
                    </gmd:MD_LegalConstraints>
                </gmd:resourceConstraints>
                {% endif %}
            {% endfor %}
            {% endif %}

            {% if not array_is_empty(p,'accessConstraints') %}
            {% for constraint in array_get(p, 'accessConstraints') %}
                <gmd:resourceConstraints>
                    <gmd:MD_LegalConstraints>
                        {% if constraint.RestrictionCode is defined and constraint.RestrictionCode is not empty %}
                            <gmd:accessConstraints>
                                <gmd:MD_RestrictionCode codeList="http://standards.iso.org/ittf/PubliclyAvailableStandards/ISO_19139_Schemas/resources/codelist/ML_gmxCodelists.xml#MD_RetrictionCode" codeListValue="{{ constraint.RestrictionCode|e }}">{{ constraint.RestrictionCode|e }}</gmd:MD_RestrictionCode>
                            </gmd:accessConstraints>
                        {% endif %}
                        <gmd:accessConstraints>
                            <gmd:MD_RestrictionCode codeList="http://standards.iso.org/ittf/PubliclyAvailableStandards/ISO_19139_Schemas/resources/codelist/ML_gmxCodelists.xml#MD_RetrictionCode" codeListValue="otherRestrictions">otherRestrictions</gmd:MD_RestrictionCode>
                        </gmd:accessConstraints>
                        {% if constraint.otherConstraints is defined and constraint.otherConstraints is not empty %}
                            <gmd:otherConstraints>
                                <gco:CharacterString>{{ constraint.otherConstraints|e }}</gco:CharacterString>
                            </gmd:otherConstraints>
                        {% else %}
                            <gmd:otherConstraints>
                                <gco:CharacterString>Es gelten keine Bedingungen</gco:CharacterString>
                            </gmd:otherConstraints>
                        {% endif %}
                    </gmd:MD_LegalConstraints>
                </gmd:resourceConstraints>
            {% endfor %}
            {% endif %}
            {% if not array_is_empty(p, 'spatialRepresentationType') %}
            <gmd:spatialRepresentationType>
                <gmd:MD_SpatialRepresentationTypeCode codeList="http://standards.iso.org/iso/19139/resources/gmxCodelists.xml#MD_SpatialRepresentationTypeCode" codeListValue="{{ p['spatialRepresentationType']|e }}">{{ p['spatialRepresentationType']|e }}</gmd:MD_SpatialRepresentationTypeCode>
            </gmd:spatialRepresentationType>
            {% endif %}
            {% if not array_is_empty(p, 'identLanguage') %}
                <gmd:language>
                    <gmd:LanguageCode codeListValue="{{ p['identLanguage']|e }}" codeList="http://standards.iso.org/ittf/PubliclyAvailableStandards/ISO_19139_Schemas/resources/codelist/ML_gmxCodelists.xml#LanguageCode">{{ p['identLanguage']|e }}</gmd:LanguageCode>
                </gmd:language>
            {% endif %}
            {% if not array_is_empty(p, 'topicCategory') %}
                {% for topicCategory in array_get(p, 'topicCategory') %}
                    <gmd:topicCategory>
                        <gmd:MD_TopicCategoryCode>{{ topicCategory }}</gmd:MD_TopicCategoryCode>
                    </gmd:topicCategory>
                {% endfor %}
            {% endif %}
            {% if not array_is_empty(p, 'bbox') %}
                <gmd:extent>
                    <gmd:EX_Extent>
                        <gmd:geographicElement>
                            <gmd:EX_GeographicBoundingBox>
                                <gmd:extentTypeCode>
                                    <gco:Boolean>{{ p['bbox']['extentTypeCode']|e }}</gco:Boolean>
                                </gmd:extentTypeCode>
                                <gmd:westBoundLongitude>
                                    <gco:Decimal>{{ p['bbox']['wLongitude']|e }}</gco:Decimal>
                                </gmd:westBoundLongitude>
                                <gmd:eastBoundLongitude>
                                    <gco:Decimal>{{ p['bbox']['eLongitude']|e }}</gco:Decimal>
                                </gmd:eastBoundLongitude>
                                <gmd:southBoundLatitude>
                                    <gco:Decimal>{{ p['bbox']['sLatitude']|e }}</gco:Decimal>
                                </gmd:southBoundLatitude>
                                <gmd:northBoundLatitude>
                                    <gco:Decimal>{{ p['bbox']['nLatitude']|e }}</gco:Decimal>
                                </gmd:northBoundLatitude>
                            </gmd:EX_GeographicBoundingBox>
                        </gmd:geographicElement>
                    </gmd:EX_Extent>
                </gmd:extent>
            {% endif %}

            {% if not array_is_empty(p, 'temporalExtentBegin') and not array_is_empty(p, 'temporalExtentEnd') %}
            <gmd:extent>
                <gmd:EX_Extent>
                        <gmd:temporalElement>
                            <gmd:EX_TemporalExtent>
                                <gmd:extent>
                                    <gml:TimePeriod gml:id="temporalextent">
                                        {% if not array_is_empty(p, 'temporalExtentBegin') %}
                                        <gml:beginPosition>{{ p['temporalExtentBegin']|e }}</gml:beginPosition>
                                        {% endif %}
                                        {% if not array_is_empty(p, 'temporalExtentEnd') %}
                                        <gml:endPosition>{{ p['temporalExtentEnd']|e }}</gml:endPosition>
                                        {% endif %}
                                    </gml:TimePeriod>
                                </gmd:extent>
                            </gmd:EX_TemporalExtent>
                        </gmd:temporalElement>
                </gmd:EX_Extent>
            </gmd:extent>
            {% endif %}
        </gmd:MD_DataIdentification>
    </gmd:identificationInfo>

    <gmd:distributionInfo>
        <gmd:MD_Distribution>
            {% if not array_is_empty(p, 'distributionFormat') %}
                {% for distributionFormat in array_get(p, 'distributionFormat') %}
                    {% if array_all_exists(distributionFormat, ['name', 'version', 'specification']) %}
                    <gmd:distributionFormat>
                        <gmd:MD_Format>
                            <gmd:name>
                                <gco:CharacterString>{{ distributionFormat.name }}</gco:CharacterString>
                            </gmd:name>
                            <gmd:version>
                                <gco:CharacterString>{{ distributionFormat.version }}</gco:CharacterString>
                            </gmd:version>
                            <gmd:specification>
                                <gco:CharacterString>{{ distributionFormat.specification }}</gco:CharacterString>
                            </gmd:specification>
                            <gmd:fileDecompressionTechnique>
                                <gco:CharacterString>{{ distributionFormat.fileDecompressionTechnique|default('none') }}</gco:CharacterString>
                            </gmd:fileDecompressionTechnique>
                        </gmd:MD_Format>
                    </gmd:distributionFormat>
                    {% endif %}
                {% endfor %}
            {% endif %}
            {% if not array_is_empty(p, 'transferOptions') %}
                <gmd:transferOptions>
                    <gmd:MD_DigitalTransferOptions>
                        {%  if p['transferOptions']['unitsOfDistribution'] is defined %}
                            <gmd:unitsOfDistribution>
                                <gco:CharacterString>{{ p['transferOptions']['unitsOfDistribution']|e }}</gco:CharacterString>
                            </gmd:unitsOfDistribution>
                        {% endif %}
                        <gmd:onLine>
                            <gmd:CI_OnlineResource>
                                {%  if p['transferOptions']['url'] is defined %}
                                    <gmd:linkage>
                                        <gmd:URL>{{ p['transferOptions']['url']|e }}</gmd:URL>
                                    </gmd:linkage>
                                {% endif %}
                                {%  if p['transferOptions']['urlDescription'] is defined %}
                                    <gmd:description>
                                        <gco:CharacterString>{{ p['transferOptions']['urlDescription']|e }}</gco:CharacterString>
                                    </gmd:description>
                                {% endif %}
                                {%  if p['transferOptions']['function'] is defined %}
                                    <gmd:function>
                                        <gmd:CI_OnLineFunctionCode codeList="http://www.isotc211.org/2005/resources/Codelist/gmxCodelists.xml" codeListValue="{{ p['transferOptions']['function']|e }}">{{ p['transferOptions']['function']|e }}</gmd:CI_OnLineFunctionCode>
                                    </gmd:function>
                                {% endif %}
                            </gmd:CI_OnlineResource>
                        </gmd:onLine>
                    </gmd:MD_DigitalTransferOptions>
                </gmd:transferOptions>
            {% endif %}
        </gmd:MD_Distribution>
    </gmd:distributionInfo>

    <gmd:dataQualityInfo>
        <gmd:DQ_DataQuality>
            <gmd:scope>
                <gmd:DQ_Scope>
                    {% if not array_is_empty(p,'hierarchyLevel') %}
                    <gmd:level>
                        <gmd:MD_ScopeCode codeList="http://standards.iso.org/ittf/PubliclyAvailableStandards/ISO_19139_Schemas/resources/codelist/ML_gmxCodelists.xml#MD_ScopeCode" codeListValue="{{ p['hierarchyLevel']|e }}">{{ p['hierarchyLevel']|e }}</gmd:MD_ScopeCode>
                    </gmd:level>
                    {% endif %}
                </gmd:DQ_Scope>
            </gmd:scope>

            {% if not array_is_empty(p, 'report') %}
            {% for report in array_get(p, 'report') %}
            {% if array_all_exists(report, ['title']) %}
            <gmd:report>
                <gmd:DQ_DomainConsistency xsi:type="gmd:DQ_DomainConsistency_Type">
                    <gmd:result>
                        <gmd:DQ_ConformanceResult xsi:type="gmd:DQ_ConformanceResult_Type">
                            <gmd:specification>
                                <gmd:CI_Citation>
                                    {% if report.title is defined %}
                                    <gmd:title>
                                        <gco:CharacterString>{{ report.title }}</gco:CharacterString>
                                    </gmd:title>
                                    {% endif %}
                                    {% if report.creationDate is defined and report.creationDate is not empty %}
                                    <gmd:date>
                                        <gmd:CI_Date>
                                            <gmd:date>
                                                <gco:Date>{{ report.creationDate|date("Y-m-d")|e }}</gco:Date>
                                            </gmd:date>
                                            <gmd:dateType>
                                                <gmd:CI_DateTypeCode codeList="http://www.isotc211.org/2005/resources/codelist/gmxCodelists.xml#CI_DateTypeCode" codeListValue="creation">creation</gmd:CI_DateTypeCode>
                                            </gmd:dateType>
                                        </gmd:CI_Date>
                                    </gmd:date>
                                    {% endif %}
                                    {% if report.publicationDate is defined and report.publicationDate is not empty %}
                                    <gmd:date>
                                        <gmd:CI_Date>
                                            <gmd:date>
                                                <gco:Date>{{ report.publicationDate|date("Y-m-d")|e }}</gco:Date>
                                            </gmd:date>
                                            <gmd:dateType>
                                                <gmd:CI_DateTypeCode codeList="http://www.isotc211.org/2005/resources/codelist/gmxCodelists.xml#CI_DateTypeCode" codeListValue="publication">publication</gmd:CI_DateTypeCode>
                                            </gmd:dateType>
                                        </gmd:CI_Date>
                                    </gmd:date>
                                    {% endif %}
                                    {% if report.revisionDate is defined and report.revisionDate is not empty %}
                                    <gmd:date>
                                        <gmd:CI_Date>
                                            <gmd:date>
                                                <gco:Date>{{ report.revisionDate|date("Y-m-d")|e }}</gco:Date>
                                            </gmd:date>
                                            <gmd:dateType>
                                                <gmd:CI_DateTypeCode codeList="http://www.isotc211.org/2005/resources/codelist/gmxCodelists.xml#CI_DateTypeCode" codeListValue="revision">revision</gmd:CI_DateTypeCode>
                                            </gmd:dateType>
                                        </gmd:CI_Date>
                                    </gmd:date>
                                    {% endif %}
                                    {% if report.edition is defined and report.edition is not empty %}
                                    <gmd:edition>
                                        <gco:CharacterString>{{ report.edition|e }}</gco:CharacterString>
                                    </gmd:edition>
                                    {% endif %}
                                </gmd:CI_Citation>
                            </gmd:specification>
                            {% if report.explanation is defined %}
                            <gmd:explanation>
                                <gco:CharacterString>{{ report.explanation|e }}</gco:CharacterString>
                            </gmd:explanation>
                            {% endif %}
                            {% if report.pass is defined and report.pass is not sameas('unknown') %}
                            <gmd:pass>
                                <gco:Boolean>{{ report.pass|e }}</gco:Boolean>
                            </gmd:pass>
                            {% else %}
                                <gmd:pass gco:nilReason="unknown"/>
                            {% endif %}
                        </gmd:DQ_ConformanceResult>
                    </gmd:result>
                </gmd:DQ_DomainConsistency>
            </gmd:report>
            {% endif %}
            {% endfor %}
            {% endif %}
        </gmd:DQ_DataQuality>
    </gmd:dataQualityInfo>
</gmd:MD_Metadata>
